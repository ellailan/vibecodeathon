<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Should I Get Out of Bed?</title>

<style>
    
    
    body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 25px;
    }

    h1, h2 {
        margin: 0;
    }

    /* ========== Layout Containers ========== */
    #mood-section,
    #crush-section,
    #ask-section {
        width: 100%;
        max-width: 450px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    }

    /* ========== Mood Buttons ========== */
    #mood-container {
        display: flex;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .mood-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 3px solid transparent;
        cursor: pointer;
        transition: transform 0.15s ease, border 0.15s ease;
    }

    .mood-btn.selected {
        border: 3px solid black;
        transform: scale(1.2);
    }

    .course-input {
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }


    #courseCode {
        padding: 10px 14px;
        font-size: 1rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        text-transform: uppercase; /* auto-uppercase user input */
    }


    #courseError {
        color: #d9534f;
        font-size: 0.9rem;
        min-height: 1.2em; /* reserve space to prevent layout jump */
    }


    /* ========== Crush Buttons ========== */
    #crush-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .crush-btn {
        padding: 10px 20px;
        font-size: 1rem;
        border-radius: 12px;
        background: #ddd;
        cursor: pointer;
        border: 2px solid transparent;
    }

    .crush-btn.selected {
        border: 2px solid black;
        background: #bfe0ff;
    }


    /* ========== Main Ask Button ========== */
    #askButton {
        font-size: 3rem;
        padding: 15px 35px;
        border: none;
        border-radius: 20px;
        background: #4a90e2;
        color: white;
        cursor: pointer;
    }

    #askButton:active {
        background: #357ac8;
    }

    /* ========== Result Box ========== */
    #result {
        font-size: 4rem;
        font-weight: bold;
        min-height: 120px;
        margin-top: 20px;
    }

</style>
</head>

<body>

<!-- Mood Section -->
<div id="mood-section">
    <h2>How do you feel today?</h2>
    <div id="mood-container">
        <div class="mood-btn" data-value="1" style="background:#d62727;"></div>
        <div class="mood-btn" data-value="2" style="background:#ff7f0e;"></div>
        <div class="mood-btn" data-value="3" style="background:#ffdd00;"></div>
        <div class="mood-btn" data-value="4" style="background:#a8e458;"></div>
        <div class="mood-btn" data-value="5" style="background:#34c759;"></div>
    </div>
</div>

<!-- Crush Section -->
<div id="crush-section">
    <h2>Is your crush in your first class?</h2>
    <div id="crush-container">
        <button class="crush-btn" id="crushYes">Yes</button>
        <button class="crush-btn" id="crushNo">No</button>
    </div>
</div>

<!-- Ask Button -->
<div class="button-container">
    <h1>Should I Get Out of Bed?</h1>


    <!-- NEW: course code input -->
    <div class="course-input">
        <label for="courseCode">Course code</label>
        <input
            id="courseCode"
            type="text"
            maxlength="7"
            placeholder="e.g. CPSC210"
        >
        <div id="courseError"></div>
    </div>
    <!-- END NEW -->

    <button id="askButton">?</button>
</div>


<!-- Result -->
<div id="result"></div>


<script>
    let moodScore = 3;
    let crushInClass = false;

    /* ========= Mood Logic ========= */
    const moodButtons = document.querySelectorAll(".mood-btn");
    moodButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            moodButtons.forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            moodScore = parseInt(btn.dataset.value);
        });
    });
    moodButtons[2].classList.add("selected");

    /* ========= Crush Logic ========= */
    const crushYes = document.getElementById("crushYes");
    const crushNo = document.getElementById("crushNo");

    crushYes.addEventListener("click", () => {
        crushInClass = true;
        crushYes.classList.add("selected");
        crushNo.classList.remove("selected");
    });

    crushNo.addEventListener("click", () => {
        crushInClass = false;
        crushNo.classList.add("selected");
        crushYes.classList.remove("selected");
    });

    /* ========= Ask Logic (MERGED) ========= */
    document.getElementById("askButton").addEventListener("click", async () => {

        const resultEl = document.getElementById("result");
        const courseInputEl = document.getElementById("courseCode");
        const courseErrorEl = document.getElementById("courseError");
        resultEl.textContent = "";
        courseErrorEl.textContent = "";

        // Hide mood and crush questions
        document.getElementById("mood-section").style.display = "none";
        document.getElementById("crush-section").style.display = "none";

        /* ===== COURSE VALIDATION ===== */
        let courseCode = courseInputEl.value.trim().toUpperCase();
        const coursePattern = /^[A-Z]{4}[0-9]{3}$/;

        if (!coursePattern.test(courseCode)) {
            courseErrorEl.textContent =
                "Course code must be 4 capital letters followed by 3 digits (e.g. CPSC210).";
            return;
        }

        const subject = courseCode.slice(0, 4);
        const level = parseInt(courseCode.slice(4));

        let classDecisionScore = 0;

        if (level >= 100 && level < 200) classDecisionScore += 100;
        if (subject === "POLI") classDecisionScore -= 50;
        if (subject === "CPSC" || subject === "MATH") classDecisionScore += 100;

        try {
            /* ===== TIME ===== */
            const now = new Date();
            const vancouverTime = now.toLocaleString("en-US", { timeZone: "America/Vancouver" });
            const hour = new Date(vancouverTime).getHours();
            const isAfternoon = hour >= 12 && hour < 24;

            /* ===== WEATHER API ===== */
            const url =
                "https://api.open-meteo.com/v1/forecast?latitude=49.2497&longitude=-123.1193&current_weather=true&hourly=cloudcover,precipitation";

            const response = await fetch(url);
            const data = await response.json();

            const temperature = data.current_weather.temperature;
            const code = data.current_weather.weathercode;

            const isCloudy = code >= 1 && code <= 3;
            const isRainy = (code >= 51 && code <= 67) || (code >= 80 && code <= 82);

            /* ===== WEATHER SCORING ===== */
            let weatherScore = 0;
            if (isAfternoon) weatherScore += 100;
            if (temperature > 7 && !isCloudy && !isRainy) weatherScore += 50;
            if (isRainy) weatherScore -= 40;
            if (isCloudy) weatherScore -= 10;

            /* ===== MOOD + CRUSH ===== */
            if (moodScore >= 4) weatherScore += 30;
            if (moodScore <= 2) weatherScore -= 30;

            if (crushInClass) weatherScore += 200;

            /* ===== FINAL DECISION ===== */
            const totalScore = weatherScore + classDecisionScore;
            const shouldGetOutOfBed = totalScore >= 50;

            resultEl.innerHTML = `
                <h2>${shouldGetOutOfBed ? "YES" : "NO"}</h2>
                <div style="font-size: 2rem;">
                    ${parseInt(temperature)}¬∞C
                    ${isCloudy ? "üå§Ô∏è" : "üå•Ô∏è"}
                    ${isRainy ? "üåßÔ∏è" : "üåÇ"}
                    <br><small>${hour}:00 in Vancouver</small>
                    <br><small>Course: ${courseCode}</small>
                    <br><small>Mood: ${moodScore}</small>
                    <br><small>Crush in class: ${crushInClass ? "Yes" : "No"}</small>
                </div>
            `;

        } catch (err) {
            console.error(err);
        }
    });
</script>


</body>
</html>
